<!DOCTYPE html>
<html>
  <head>
    <title>自作</title>
    <meta name="viewport" content="width=device-width, user-scalable=no">
<style type="text/css">
body { margin: 0px; overflow: hidden; }
/* canvas { border: 1px solid black; } */
</style>
<script type="text/javascript" src="magictouch.js"></script>
<script type="text/javascript">
var canvas, ctx;
var w = 0, h = 0;
var timer;
var ox = -1, oy = -1;
var updateStarted = false;
var touches = [];
var nw = window.innerWidth;
var nh = window.innerHeight;
var mx = nw / 2;
var my = nh / 2;
var nx, ny;
var flg = 1;

function update() {
  if(updateStarted) return;
  updateStarted = true;

  if ((w != nw) || (h != nh)) {
    w = nw;
    h = nh;
    canvas.style.width = w+'px';
    canvas.style.height = h+'px';
    canvas.width = w;
    canvas.height = h;
  }
  ctx.clearRect(0, 0, w, h);
  var i, len = touches.length;

  // 初期表示
  ctx.arc(mx, my, 20, 0, 2*Math.PI, true);
  ctx.fillStyle = "rgba(0, 0, 200, 0.2)";
  ctx.fill();
  ctx.lineWidth = 2.0;
  ctx.strokeStyle = "rgba(0, 0, 200, 0.8)";
  ctx.stroke();

  for(i=0; i<len; i++) {
    var touch = touches[i];
    if (flg == 1){
      nx = touch.pageX;
      ny = touch.pageY;
    } else {
      ;
    }

    ctx.beginPath();
    if(ox == -1 || oy == -1){
      ox = nx;
      oy = ny;
    }
    var x = nx - ox;
    var y = ny - oy;

    mx += x;
    my += y;

    ctx.arc(mx, my, 20, 0, 2*Math.PI, true);
    ctx.fillStyle = "rgba(0, 0, 200, 0.2)";
    ctx.fill();
    ctx.lineWidth = 2.0;
    ctx.strokeStyle = "rgba(0, 0, 200, 0.8)";
    ctx.stroke();
    ox = nx;
    oy = ny;
    nx = touch.pageX;
    ny = touch.pageY;
    console.log('nx：' + nx + '\nny：' + ny);
  }
  updateStarted = false;
}
function ol() {
	canvas = document.getElementById('canvas');
	ctx = canvas.getContext('2d');
	timer = setInterval(update, 15);
  canvas.addEventListener('touchend', function() {
    ctx.clearRect(0, 0, w, h);
    console.log('end');
    flg = 0;
    // nx = ny = 0;
  });
  canvas.addEventListener('touchmove', function(event) {
    event.preventDefault();
    touches = event.touches;
  });
  canvas.addEventListener('touchstart', function(event) {
    console.log('start');
    nx = touch.pageX;
    ny = touch.pageY;
    flg = 1;
  });
};
</script>
</head>
<body onload="ol()">

<canvas id="canvas" width="300" height="300" style="top:0px; left:0px; width: 300px; height: 300px;"></canvas>
<object id="tuio" type="application/x-tuio">Plugin FAILED to load</object>

</body>
</html>
